{include file="common/heads" /}
<link rel="stylesheet" href="__STATIC__/hy/assets/style/index.css">
    <link rel='stylesheet' href='__STATIC__/hy/assets/style/reset_android.css'>
    <script src="__STATIC__/hy/assets/js/reset.js"></script>
     <script src="__STATIC__/hy/assets/js/qrcode.js"></script>
     <script src="__STATIC__/hy/assets/js/qrcode_with_logo.js"></script>
    <script src="__STATIC__/hy/assets/js/utf.js"></script>
    <style>
    	.body_Hearcont{
    		display: none !important;
    	}
    	.body_Footcont{
    		display: none !important;
    	}
    	.xs {
		    position: absolute;
		    right: 1rem;
		    top: 0.8rem;
		    font-size: 0.26rem;
		    padding: 0.08rem 0.1rem;
		    box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.4);
		    background-color: #FB9220;
		    border-radius: 0.06rem;
		    color: #fff;
		}
		.mask {
		    width: 100%;
		    height: 100%;
		    padding: 0 0.2rem;
		    background-color: rgba(0, 0, 0, 0.3);
		    position: fixed;
		    top: 0px;
		    left: 0px;
		    display: none;
		    text-align: center;
		    z-index: 999;
		}
		.mask .img {
		    /* width: 100%; */
		    position: absolute;
		    left: 50%;
		    top: 50%;
		    transform: translate(-50%,-50%);
		}
		.mask .img div {
		    width: 100%;
		    height: auto;
		}
		.top_left select{
			background: #fff;
		}
		.top_left select option{
			font-size: 0.22rem;
		}
		.editimg{
			position: fixed;
			bottom: 0;
			width: 100%;
			height: 2rem;
			background: #fff;
			z-index: 9999;
			display: none;
		}
		.editimg div{
		    width: 100%;
		    height: 0.6rem;
		    text-align: center;
		    line-height: 0.6rem;
		    margin-top: 0.3rem;
		    /* border-bottom: 1px solid; */
		    /* border: 1px solid blue; */
		    /* border-radius: 0.2rem; */
		    background: #fff;
		}
    </style>
<!--幻灯片开始---->
<div class="top">
        <div class="top_box">
            <div class="top_left">
                <select>
                    <option value="广州">广州</option>
                    <option value="中山">中山</option>
                    <option value="南海">佛山</option>
                    <option value="东莞">东莞</option>
                    <option value="深圳">深圳</option>
                </select>
            </div>
            <div class="top_center">
                <i class="fa fa-search"></i>
                <form action="" method="get" class="forms" style="line-height: 0.6rem;"> 
                <input type="text" id="hytitle" placeholder="请输入关键字">
                </form>
            </div>
            <div class="top_right">···</div>
        </div>
        <div class="nav">
            <div class="navbox">
                <div class="check" onclick="navclick(this)">推荐</div>
                <div style="display: none;" onclick="navclick(this)">分类</div>
            </div>
            <span class="navbottom"></span>
        </div>
        <div class="Carousel">
        	<a href="/index.php/hy/content/ruzhu">
        		<img src="__STATIC__/hy/assets/images/advertisement_1.png" alt="">
        	</a>
            
        </div>
        <div class="tab">
            <div class="tab_left" onclick="window.location.href='/index.php/hy/content/boutique'">
                <span>
                    <img src="__STATIC__/hy/assets/images/orangeicon.png" alt="">
                    <img src="__STATIC__/hy/assets/images/curriculumicon.png" alt="">
                </span>
                精品课程
            </div>
            <div class="tab_right">
                <span>
                    <img src="__STATIC__/hy/assets/images/blueicon.png" alt="">
                    <img src="__STATIC__/hy/assets/images/keicon.png" alt="">
                </span>
               享&nbsp;&nbsp;课
            </div>
        </div>
    </div>
    <?php echo '<script> var doma=[]; var gid=[];var gtitle=[];var gpicurl=[]; </script>'; ?>
    <div class="center">
        <div class="center_img">
            <img src="__STATIC__/hy/assets/images/advertisement_2.png" alt="">
        </div>
        <h3>推荐机构</h3>
        <div class="curriculum">
        	{qb:tag name="hy_wapindex002" type="hy" by="asc" order="list" rows="3" where="istop=1" }
	            <div class="ListBox">
	                <div class="box" onclick="window.location.href='{$rs.url}'" data-url="{$rs.picurl}">
	                    <div class="listtop" style="display: flex;"> <img src="/public/{$rs.picurl}" onerror="this.src='__STATIC__/images/jichuangsi.jpg'"  /> </div>
	                    <div class="listbottom">
	                        <div class="title">{$rs.title}</div>
	                        <div class="text">{$rs.content}</div>
	                        <div class="star_{$rs.id}">
	                            <!-- <img src="__STATIC__/hy/assets/images/Stars.png" alt="">
	                            <img src="__STATIC__/hy/assets/images/Stars.png" alt="">
	                            <img src="__STATIC__/hy/assets/images/Stars.png" alt=""> -->
	                        </div>
	                         <script>
		                         showXing();
		                         doma.push("{$rs.domainname}");
		                         gid.push("{$rs.id}");
		                         gtitle.push("{$rs.title}");
		                         gpicurl.push("{$rs.picurl}");
		                         function showXing(){
		                         	var xinnum={:fun('xiangke@getcommgradexin',$rs['id'])};
		                             var commtext='';
		                             console.log(xinnum);
		                             for(var j=0;j<xinnum;j++){
		         						commtext+='<span><img style="width:0.19rem;height:0.18rem" src="__STATIC__/hy/assets/images/Stars.png" alt=""></span>';
		         					}
		                             for(var j=xinnum;j<5;j++){
		         						commtext+='<span><img style="width:0.19rem;height:0.18rem" src="__STATIC__/hy/assets/images/huix.png" alt=""></span>';
		         					}
		                             $('.star_'+{$rs.id}).append(commtext);
		                         }
					        </script>
	                        <div class="money"><!-- <script>ssr('{$rs.domainname}')</script> --></div>
	                    </div>
	                    <div class="Sold" style="display:none">已售177</div>
	                    <div class="go"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></div>
	                </div>
	            </div>
            {/qb:tag}
        </div>
        
	<script>  
			var timeOutEvent=0;//定时器   
			//开始按   
			function gtouchstart(){   
			    timeOutEvent = setTimeout("longPress()",500);//这里设置定时器，定义长按500毫秒触发长按事件，时间可以自己改，个人感觉500毫秒非常合适   
			    return false;   
			};   
			//手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件   
			function gtouchend(){   
			    clearTimeout(timeOutEvent);//清除定时器   
			    if(timeOutEvent!=0){   
			        //这里写要执行的内容（尤如onclick事件）   
			        console.log("你这是点击，不是长按");   
			    }   
			    return false;   
			};   
			//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按   
			function gtouchmove(){   
			    clearTimeout(timeOutEvent);//清除定时器   
			    timeOutEvent = 0;   
			      
			};   
			   
			//真正长按后应该执行的内容   
			function longPress(){   
			    timeOutEvent = 0;   
			    //执行长按要执行的内容，如弹出菜单   
			    console.log("长按事件触发发");   
			    $('.editimg').show();
			}
			function convertCanvasToImage() {
				var image = new Image();
				var canvas=$('#qrcode canvas');
				image.src = canvas.toDataURL("image/png");
				console.log(image);
			}
			function saveFile(){
				var data=$('#testimg').attr('src');
				console.log(data);
			    var save_link=document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
			    save_link.href=data;
			    save_link.download="lxk";
			    var event=document.createEvent('MouseEvents');
			    event.initMouseEvent('click',true,false,window,0,0,0,0,0,false,false,false,false,0,null);
			    save_link.dispatchEvent(event);
			  };
	</script>  
         <!-- 改 -->
	    <div class="mask" onclick="hide()">
	        <div class="img">
	            <!-- <img src="" alt=""> -->
	            <div id="qrcode" ontouchstart="gtouchstart()" ontouchmove="gtouchmove()" ontouchend="gtouchend()"></div>  
	            <img style="display: none;" src="" id="testimg" />
	        </div>
	    </div>
    	<div class="editimg">
    		<div onclick="saveFile()">保存图片</div>
    		<div onclick="editimgcancel()">取消</div>
    	</div>
    	
    <!-- 改 -->
    
    
        <div onclick="window.location.href='/index.php/hy/content/index/fid/9.html'" style="margin-top: -0.5rem;width: 100%;height: 1rem;display: flex;"><div style="margin: auto;background: #FF8522;width: 2.16rem;height: 0.66rem;text-align: center;border-radius: 0.1rem;line-height: 0.66rem;color: #FFFFFF;font-size: 0.3rem;">MORE</div></div>
        <script>
        	function editimgcancel(){
        		$('.editimg').css('display','none');
        	}
        	function xs(e,id,gid){
		         qrcodes(id,gid);
		        $('.mask').css('display','block'); 
		    }
		   	function hide(){
		        $('.mask').css('display','none');
		        $('.editimg').css('display','none');
		    }
        	function qrcodes(qrid,gid){
//		   		var qrcode = new QRCode(document.getElementById("qr"+qrid), {
//						width : 100,
//						height : 100
//					});
					var domainname=$("#qr"+qrid).attr("data-url")
					var domurl=domainname.substring(7,domainname.length);
					var protocol = window.location.protocol;
					var host = window.location.host;
					var port = window.location.port;
					if(!host) return;
					domain = (protocol?protocol+'//':'')+host;
//					qrcode.makeCode(domain+"/index.php/cms/content/shareurl/d/"+domurl+"/k/"+qrid+"/u/{$userdb.uid}/g/{$info.id}");
					console.log(domain+"/index.php/cms/content/shareurl/d/"+domurl+"/k/"+qrid+"/u/{$userdb.uid}/g/{$info.id}")
					$("#qrcode").empty();
					var qrcode=$("#qrcode").qrcode({
			            render : "canvas",    //设置渲染方式，有table和canvas，使用canvas方式渲染性能相对来说比较好
			            text : domain+"/index.php/cms/content/shareurl/d/"+domurl+"/k/"+qrid+"/u/{$userdb.uid}/g/"+gid,    //扫描二维码后显示的内容,可以直接填一个网址，扫描二维码后自动跳向该链接
			            width : "300",               //二维码的宽度
			            height : "300",              //二维码的高度
			            background : "#ffffff",       //二维码的后景色
			            foreground : "#000000",        //二维码的前景色
			            src: "__STATIC__/hy/assets/images/lx.png"             //二维码中间的图片
			        });
			         var canvas=qrcode.find('canvas').get(0);
	                 var data = canvas.toDataURL('image/jpg');
	                 $('#testimg').attr('src',data);
//	                 saveFile(data,"fd范德萨范德萨");
					  //转为图片的方法,需要上门的data
		   	}
        	
        	function errorImg(imgs){
        		var picurl=$(imgs).attr("data-data");
        		if(picurl!=null&&picurl!=""){
        			imgs.src = "/public/"+picurl; imgs.onerror = null; return false;
        		}
        		imgs.src = "__STATIC__/images/jichuangsi.jpg"; imgs.onerror = null; 
        	}
        	function ssrr(domainname){
        		console.log(domainname);
        		$.ajax({
				    url:"http://192.168.31.108:92/index.php/api/course/recommendQuery",
				    type:"GET",
				    success:function(data){
				    	 var datas=JSON.parse(data);
				        console.log(datas);
				    }
				});	
        	}
        </script>
        <script>
        	$(function(){
        		if(doma!=null&&doma!=""&&doma!=undefined&&gid!=null&&gid!=""&&gid!=undefined){
        			for(var i=0;i<doma.length;i++){
        				ssr(doma[i],gid[i],gtitle[i],gpicurl[i]);
        				console.log("~~~"+gpicurl[i])
        			}
        		}
        	});
        		function ssr(domainname,gid,gtitle,gpicurl){
        		if(domainname!=undefined&&domainname!=null&&domainname!=''){
	        		$.ajax({
					    url:domainname+"/index.php/api/course/recommendQuery",
					    type:"GET",
					    async:true,
					    success:function(res){
					    	 var datas=JSON.parse(res);
					        console.log(datas);
					        var listdata=datas.data;
					        for(var i in listdata){
					        	var retest="";
					        	retest+='<div class="ListBox">';
					        	retest+=' <div class="box">';
					        	retest+='<div class="listtop"><img src="'+listdata[i]['imageurl']+'" onerror="errorImg(this)" data-data="'+gpicurl+'"  /></div>';
					        	retest+='<div class="listbottom">';
					        	retest+=' <div class="title">机构：'+gtitle+'</div>';
					        	retest+=' <div class="title" style="font-size: 0.25rem;line-height: 0.4rem;width:2.5rem">'+listdata[i]['title']+'</div>';
					        	retest+=' <div class="star">点击次数 : '+listdata[i]['view']+'</div>';
					        	retest+=' <div class="money">¥ '+listdata[i]["price"]+'</div>';
					        	retest+='</div>';
					        	retest+='<div class="Sold">已售'+listdata[i]['sold']+'</div>';
					        	retest+=' <a href="'+domainname+'/index.php?s=/live/index/detail/id/'+listdata[i]['id']+'" class= "go"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>';
					        	<?php
						        		if($userdb){ 
						        	?>
					        	retest+='<div class="xs" onclick="xs(this,'+listdata[i]['id']+','+gid+')">享客码</div>';
					        	retest+=' <div class="img" id="qr'+listdata[i]['id']+'" data-url="'+domainname+'"></div>';
					        	<?php
						        		}
						        	?>
					        	retest+=' </div> </div>';
					        	$('#curriculums').append(retest);
					        }
//										        sessionStorage.setItem('asd',retest)
					    }
					});	
				}
        	}
        </script>
        <h3>推荐课程</h3>
        <div class="curriculum" id="curriculums">
        </div>
        
        
        
        <h3 style="margin-top: 0;">行业信息</h3>
        <div class="curriculum industry">
         <div class="ListBox">
        {qb:tag name="cms_wapindex002" type="cms" rows="4" order="id desc,view desc" where="fid=9"}
			<div class="box">
                    <div class="listtop"> <img src="{$rs.picurl}" onerror="this.src='__STATIC__/images/jichuangsi.jpg'" data-data="{$rs.picurl}"/> </div>
                    <div class="listbottom">
                        <div style="width: 3.5rem;" class="title">{$rs.title}</div>
                        <div class="text">{$rs.content|get_word=154}</div>
                        <div class="more" onclick="window.location.href='/index.php/hy/content/hycmsshow/id/{$rs.id}'">了解更多</div>
                    </div>
            </div>
		{/qb:tag} 
		</div>
		</div>
    </div>
    <div class="foot">
        <div>
            <img src="__STATIC__/hy/assets/images/home.png" alt="">
            <span class="check">首页</span>
        </div>
        <div onclick="window.location.href='/index.php/hy/content/ruzhu'">
            <img src="__STATIC__/hy/assets/images/ruzhus.png" alt="">
            <span>入驻</span>
        </div>
        <div onclick="window.location.href='/index.php/hy/content/personal'">
            <img src="__STATIC__/hy/assets/images/myde.png" alt="">
            <span>我的</span>
        </div>
    </div>
    <script>
    	var oForm =  document.getElementsByTagName("form")[0];
		oForm.onsubmit = function(){
		    var hytitle=$("#hytitle").val();
		    if(hytitle!=null && hytitle!=""){
				$(".forms").attr("action","/index.php/hy/content/index/hytitle/"+hytitle);
		    }else{
		    	return false;
		    }
		};
        function navclick(e){
            $(e).addClass('check').siblings().removeClass()
            if($(e).text()=='推荐'){
                $('.navbottom').css('left','0.5rem')
            }else {
                $('.navbottom').css('left','1.6rem')
            }
        }
        // var u = navigator.userAgent;
        // var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
        // var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        // // alert('是否是Android：'+isAndroid);
        // // alert('是否是iOS：'+isiOS);
        // if(isAndroid){
        //     document.write("<link rel='stylesheet' href='./assets/style/reset_android.css'>")
        // }else if(isiOS){
        //     document.write("<link rel='stylesheet' href='./assets/style/reset_ios.css'>")
        // }
</script>




<script type="text/javascript" src="__STATIC__/mui/js/mui.min.js"></script>
<link rel="stylesheet" href="__STATIC__/index/default/slider.css">
<!--幻灯片结束---->
<link rel="stylesheet" href="__STATIC__/group/index.css">
<div class="MainContainer">
	<div class="HotGroupBox" style="display: none;">
		<div class="head">热门商铺</div>
		<div id="ListGroup">
			<ul>
				{qb:tag name="hy_wapindex001" type="hy" order="status" by="desc" rows="10"}
				<li><a href="{$rs.url}"><span><img src="{$rs.picurl}" onerror="this.src='__STATIC__/images/nopic.png'"></span><em>{$rs.title}</em></a></li>
				{/qb:tag}
			</ul>
		</div>
	</div>
</div>

<script type="text/javascript">
var ajax_url_db = ['{qb:url name="hy_wapindex_shop001"/}','{qb:url name="hy_wapindex_photo001"/}','{qb:url name="hy_wapindex_bbs001"/}'];
var choose_i = 0; //选中第几项
var shoppage = 1;
var haveshowpage = []; //每一项,作个标志,已经已显示到第几页
//显示更多
function showMoreContent(){	
	var url = ajax_url_db[choose_i];	//第几项对应的网址
	shoppage++;
	haveshowpage[choose_i] = shoppage;
	layer.msg("加载中...",{time:1000});
	$.get(url+shoppage+'&'+Math.random(),function(res){
		if(res.code==0){
			if(res.data==''){
				layer.msg("已经显示完了！",{time:500});
				$('.ShowMores').off("click");
				$('.ShowMores span').html('显示完了');
				$('.ShowMores span').css({'background':'#eee'});
			}else{
				$('.ShowContentType .Contents').eq(choose_i).append(res.data);
			}
		}else{
			layer.msg(res.msg,{time:2500});
		}
	});
}

//切换显示
function showContentType(num){

	choose_i = num;
	shoppage = haveshowpage[choose_i]>1 ? haveshowpage[choose_i] : 1;
	$('.ShowMores').off("click"); //避免出现多次点击事件
	$('.ShowMores').on("click",showMoreContent);
	$('.ShowMores span').html('查看更多');

	$('.ShowContentType .tags span').removeClass('ck');
	$('.ShowContentType .tags span').eq(num).addClass('ck');
	$('.ShowContentType .Contents').hide();
	$('.ShowContentType .Contents').eq(num).show();
}
$('.ShowContentType .tags span').click(function(){
	var thisnum=$(this).index();
	showContentType(thisnum);
});
showContentType(0);
</script>
</body>
</html>